import { getDatabase } from '../lib/mongodb';

async function clearVulnerabilityData() {
  try {
    console.log('üóëÔ∏è  Clearing existing vulnerability data...');
    
    const db = await getDatabase();
    const collection = db.collection('vulnerabilities');
    
    // Clear all existing vulnerabilities
    const result = await collection.deleteMany({});
    console.log(`‚úÖ Cleared ${result.deletedCount} vulnerabilities from MongoDB`);
    
    // Also clear any indexes to start fresh
    try {
      await collection.dropIndexes();
      console.log('‚úÖ Dropped all indexes');
    } catch (error: any) {
      if (error.code === 27) {
        console.log('‚ÑπÔ∏è  No indexes to drop');
      } else {
        console.log('‚ö†Ô∏è  Could not drop indexes:', error.message);
      }
    }
    
    console.log('üéâ Data clearing completed successfully!');
    process.exit(0);
  } catch (error) {
    console.error('‚ùå Error clearing data:', error);
    process.exit(1);
  }
}

// Run the clearing function if this file is executed directly
if (require.main === module) {
  clearVulnerabilityData();
}

export { clearVulnerabilityData };
